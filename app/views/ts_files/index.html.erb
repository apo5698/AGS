<% url = "/courses/#{@course.id}/assignments/#{@assignment.id}" %>
<% html = "<li class='breadcrumb-item'><a href=#{url}>#{@assignment.name}</a></li><li class='breadcrumb-item active'>TS Files</li>".html_safe %>
<%= render partial: '/assignments/header', locals: {html: html} %>

<div class="row">
  <div class="col-lg-3">
    <%= render partial: '/assignments/sidebar' %>
  </div>
  <div class="col-lg-9">
    <div class="row">
      <div class="col-lg-7">
        <%= form_with(url: "/courses/#{@course.id}/assignments/#{@assignment.id}/ts_files/upload") do |f| %>
          <div class="form-group">
            <div class="input-group">
              <div class="custom-file">
                <%= f.file_field(:files, class: 'custom-file-input', :multiple => true, name: 'files[]') %>
                <%= f.label(:zip, 'Choose file', class: 'custom-file-label') %>
              </div>
              <div class="input-group-append">
                <%= f.submit('Upload', class: 'input-group-text') %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <!-- Uploading progress -->
      <div class="col-lg-5">
        <div class="toast toast-float" role="alert" aria-live="assertive" aria-atomic="true" data-autohide="false">
          <div class="toast-header">
            <strong class="mr-auto">Upload</strong>
            <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="toast-body">
            Uploading...<i class="fa fa-spinner fa-spin ml-1"></i>
            <br/>
            Please do not refresh the page.
          </div>
        </div>
      </div>
    </div>
    <% unless @ts_files.blank? %>
      <%= form_with(url: "/courses/#{@course.id}/assignments/#{@assignment.id}/ts_files/destroy_selected") do |f| %>
        <div class="row">
          <div class="col-lg-12 mb-3">
            <div class="card">
              <div class="card-header">
                Uploaded files
              </div>
              <ul class="list-group list-group-flush">
                <% @ts_files.each do |ts_file| %>
                  <li class="list-group-item justify-content-between">
                    <div class="custom-control custom-checkbox">
                      <%= f.check_box("files[#{ts_file.id}]", class: 'custom-control-input') %>
                      <%= f.label("files[#{ts_file.id}]", ts_file.filename, class: 'custom-control-label') %>
                    </div>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-12">
            <button type="button" class="btn btn-secondary" id="select-all">Select / deselect all</button>
            <div class="form-group float-right">
              <%= f.submit('Delete', class: 'btn btn-primary') %>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      You have not uploaded any files yet.
    <% end %>
  </div>
</div>
<script>
  $(document).on('turbolinks:load', () => {
    $('input:submit').on('click', () => {
      if ($('.custom-file-label').html().trim() !== 'Choose file') {
        $('.toast').toast('show');
      }
    });
  });
</script>
