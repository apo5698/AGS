<div class="custom-control custom-checkbox mb-1">
  <%= check_box_tag('args', nil, false, class: 'custom-control-input') %>
  <label class="custom-control-label" for="args" aria-describedby="args-help">
    Argument(s)
  </label>
  <small id="args-help" class="form-text text-muted mt-0">
    Using command line arguments (<span class="code">String[] args</span>)
  </small>
  <div class="mt-2 mb-2 w-50" id="args" style="display: none">
    <div class="form-group">
      <%= form.label('options[wce][args][javac]', 'javac') %>
      <%= form.text_field('options[wce][args][javac]', class: 'form-control') %>
    </div>
    <div class="form-group">
      <%= form.label('options[wce][args][java]', 'java') %>
      <%= form.text_field('options[wce][args][java]', class: 'form-control', 'aria-describedby': 'argument-help') %>
      <small id="argument-help" class="form-text text-muted">
        Separated by spaces. If an argument contains space(s), use quotes.
      </small>
    </div>
  </div>
</div>

<div class="custom-control custom-checkbox mb-1">
  <%= check_box_tag('lib', nil, false, class: 'custom-control-input') %>
  <label class="custom-control-label" for="lib" aria-describedby="lib-help">
    Libraries
  </label>
  <small id="lib-help" class="form-text text-muted mt-0">Compile or run with external libraries</small>
  <div class="mt-2 mb-2 w-50" id="lib" style="display: none">
    <div class="form-group">
      <%# DependenciesUtil.all.keys.each do |lib| %>
      <!--<div class="form-check">-->
      <%#= form.check_box("options[library][#{lib}]", class: 'custom-control-input') %>
      <%#= form.label("options[library][#{lib}]", lib, class: 'custom-control-label') %>
      <!--</div>-->
      <%# end %>
      <div class="form-check">
        <%= form.check_box("options[wce][lib][junit]", class: 'custom-control-input') %>
        <%= form.label("options[wce][lib][junit]", 'JUnit', class: 'custom-control-label', aria: { describedby: 'lib-junit' }) %>
        <small id="lib-junit" class="form-text text-muted mt-0">
          <%= File.basename(Dependency.path('junit')) %>
        </small>
      </div>
    </div>
  </div>
</div>

<div class="custom-control custom-checkbox mb-1">
  <%= check_box_tag('stdin', nil, false, class: 'custom-control-input') %>
  <label class="custom-control-label d-inline" for="stdin" aria-describedby="stdin-help">
    Standard input
  </label>
  <small id="stdin-help" class="form-text text-muted mt-0">
    Read input from keyboard (<span class="code">Scanner(System.in)</span>)
  </small>
  <div class="mt-2 mb-2 w-50" id="stdin" style="display: none">
    <%= form.text_area('options[wce][stdin][data]', class: 'form-control', 'aria-describedby': 'stdin-help') %>
    <small id="stdin-help" class="form-text text-muted">Separated by newlines</small>
  </div>
</div>

<!-- TODO: implement -->
<div class="custom-control custom-checkbox mb-1">
  <%= check_box_tag('match', nil, false, class: 'custom-control-input', disabled: true) %>
  <label class="custom-control-label" for="match" aria-describedby="match-help">
    Output matching
  </label>
  <small id="match-help" class="form-text text-muted mt-0">Match actual output with expected</small>
  <div class="mt-2 mb-2 w-50" id="match" style="display: none">
    <%= form.range_field('options[wce][match][level]', class: 'custom-range', min: 1, max: 3, step: 1, list: 'level') %>
    <div class="col-lg-6">
      <%= form.label('options[wce][match][level]', 'Match text only', class: 'mr-2 mb-0') %>
      <a href="/help" target="_blank" data-toggle="tooltip" title="What is this?">
        <i class="far fa-question-circle"></i>
      </a>
    </div>
  </div>
</div>

<script>
  $(document).on('turbolinks:load', () => {
    $('input:checkbox').change(function () {
      const options = $(`div[id='${$(this).prop('id')}']`);
      if ($(this).prop('checked'))
        options.show();
      else
        options.hide();
    });

    const matchingLevel = val => {
      val = parseInt(val);
      switch (val) {
        case 1:
          return 'Allow differences';
        case 2:
          return 'Match text only';
        case 3:
          return 'Strict match';
        default:
          return '';
      }
    };

    $('input[id="options[wce][match][level]"]').on('change', function () {
      $('label[for="options[wce][match][level]"]').html(matchingLevel($(this).val()));
    });
  });
</script>